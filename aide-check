#!/bin/sh

# Get service config
[ -f /etc/sysconfig/aide ] && . /etc/sysconfig/aide

DATA=`date`
SYSTEM=`hostname`

if [ -f /var/lib/aide/aide.db ]; then
 nice -20 /usr/bin/aide --$AIDE_WORK_MODE >/var/lib/aide/$$
 LIN=`grep -c . /var/lib/aide/$$`
 if [ "$LIN" -gt "1" ]; then
     mail -s "AIDE $SYSTEM $DATA" $AIDE_MAILTO </var/lib/aide/$$
 fi
 rm -f /var/lib/aide/$$
 if [ $AIDE_WORK_MODE = "update" ] && [ $AIDE_MOVEDB = "yes" ]; then
     mv -f /var/lib/aide.db.new /var/lib/aide.db
 fi
else
 nice -20 /usr/bin/aide --init
 mv -f /var/lib/aide.db.new /var/lib/aide.db
fi
